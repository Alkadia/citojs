!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.cito=n()}(this,function(){"use strict";function e(e){return"string"==typeof e}function n(e){return e instanceof Array}function t(e){return"function"==typeof e}function r(e,n){var t=typeof e;return"string"===t?e={tag:"#",children:e}:"function"===t&&(e=e(n),e=void 0===e?n:r(e,n)),e}function i(e,n,t){var i=r(n,t);return n!==i&&e&&(e.children=i),i}function o(e,n,t){var r=i(null,f(e,n));return r.dom||(r.dom=t.firstChild,"<"===r.tag&&(r.domLength=t.childNodes.length)),r}function a(e,n,t){var i=e[n],o=r(i,t);return i!==o&&(e[n]=o),o}function l(e,n,r){return t(n)&&(n=n(r),void 0===n&&(n=r),e.children=n),n}function f(e,n){return 1===n?e[0]:e}function d(e,n,t){var r,i=n.dom,o=n.domLength||1,a=t&&t.dom;if(i!==a)for(;o--;)r=o>0?i.nextSibling:null,a?e.insertBefore(i,a):e.appendChild(i),i=r}function s(){return Y.createTextNode("")}function u(e,n,t){if(e.insertAdjacentHTML){var r,i,o;if(U||X){var a="beforebegin"===n?e.previousSibling:"beforeend"===n?e.lastChild:null;a&&3===a.nodeType&&(r=a,X&&0===a.length&&(o=!0,a.nodeValue=" "),U&&(i=a.length))}e.insertAdjacentHTML(n,t),r&&(U&&r.length!==i&&r.splitText(i),X&&o&&(r.nodeValue=""))}else if(oe.innerHTML=t,"beforebegin"===n)for(var l=e.parentNode;oe.firstChild;)l.insertBefore(oe.firstChild,e);else if("beforeend"===n)for(;oe.firstChild;)e.appendChild(oe.firstChild)}function c(e,n,t,r){if(t){var i=t.dom;if(r){var o=t.domLength||1;1===o?(z(t),e.replaceChild(n,i)):(e.insertBefore(n,i),I(e,t))}else e.insertBefore(n,i)}else e.appendChild(n)}function v(e,n,t,r,i,o){if(ie)return g(e,n,r,i);var a,l=e.tag,f=e.children;switch(l){case void 0:return k(e,f,n,t,r,i);case"#":if(o)return void P(n,f);a=Y.createTextNode(f);break;case"!":a=Y.createComment(f);break;case"<":if(f){if(o)n.innerHTML=f;else{var d=n.childNodes,v=d.length;if(r){var m=r.dom,p=m.previousSibling;u(m,"beforebegin",f),a=p?p.nextSibling:n.firstChild}else u(n,"beforeend",f),a=d[v];e.dom=a,e.domLength=d.length-v,i&&r&&I(n,r)}return}a=s();break;default:var b;switch(l){case"svg":b="http://www.w3.org/2000/svg";break;case"math":b="http://www.w3.org/1998/Math/MathML";break;default:b=t}var x=e.attrs,y=x&&x.is;b?(e.ns=b,a=y?Y.createElementNS(b,l,y):Y.createElementNS(b,l)):a=y?Y.createElement(l,y):Y.createElement(l),e.dom=a,ie&&n&&c(n,a,r,i),"string"==typeof f?P(a,f,!1):V(a,e,b,f,!1),x&&L(a,l,b,x);var C=e.events;C&&N(a,e,C),!ie&&n&&c(n,a,r,i);var w=C&&C.$created;return void(w&&h(w,"$created",a,e))}e.dom=a,n&&c(n,a,r,i)}function h(e,t,r,i,o,a){var l={type:t,target:r,virtualNode:i};if(o&&(l[o]=a),n(e)){for(var f=0;f<e.length;f++)if(e[f].call(r,l)===!1)return}else e.call(r,l)}function g(e,n,t,r){var i,o=m(e);if(n){var a;t||n.hasChildNodes()?(t?(a=t.dom.previousSibling,u(t.dom,"beforebegin",o),r&&I(n,t)):(a=n.lastChild,u(n,"beforeend",o)),i=a?a.nextSibling:n.firstChild):(n.innerHTML=o,i=n.firstChild)}else oe.innerHTML=o,i=oe.removeChild(oe.firstChild);p(i,e)}function m(n,t){var r=n.tag,o=n.children;switch(r){case"#":return x(o)+ue;case"!":return"<!--"+y(o)+"-->";case"<":return o+ue;default:var d;if(r){var s=n.attrs;if("select"===r&&s?t={selectedIndex:s.selectedIndex,value:s.value,optionIndex:0}:"option"===r&&t&&((t.value&&t.value===s.value||void 0!==t.selectedIndex&&t.selectedIndex===t.optionIndex)&&(s.selected=!0),t.optionIndex++),d="<"+r,s){d+=" ";for(var u in s){var c=s[u];if(c!==!1&&("select"!==r||"value"!==u&&"selectedIndex"!==u))if("textarea"!==r||"value"!==u){if(c===!0)c="";else if("style"===u&&!e(c)){var v="";for(var h in c)v+=h+": "+c[h]+"; ";c=v}d+=" "+C(u,c)}else o=c}}}else d="";r&&(d+=">"),o=l(n,o);var g=j(o);if(g>1)for(var p=0,b=o.length;b>p;p++)d+=m(a(o,p),t);else if(0!==g){var k=f(o,g);e(k)?(d+=x(k),r&&k||(d+=ue)):d+=m(i(n,k),t)}else r||(d+=ue);return r&&(d+="</"+r+">"),d}}function p(n,t){var r=t.tag;if(r){t.dom=n;var i,o;switch(r){case"#":i=n.nodeValue,o=i.indexOf(ue),-1!==o&&(o+1<i.length&&n.splitText(o+1),n.nodeValue=i.substr(0,o));break;case"!":break;case"<":for(var a,l=0;n;n=n.nextSibling)if(l++,3===n.nodeType){if(i=n.nodeValue,l>1&&i===ue){a=n.nextSibling,n.parentNode.removeChild(n),l--;break}if(o=i.indexOf(ue),-1!==o){o+1<i.length&&n.splitText(o+1),n.nodeValue=i.substr(0,o),a=n.nextSibling;break}}return t.domLength=l,a;default:var d=t.children,s=j(d);if(s>1){d=t.children;for(var u=n.firstChild,c=0,v=d.length;v>c;c++)u=p(u,d[c])}else if(0!==s){var g=f(d,s);e(g)?g||(n.firstChild.nodeValue=""):p(n.firstChild,g)}var m=t.events;if(m){N(n,t,m);var x=m.$created;x&&h(x,"$created",n,t)}}return n.nextSibling}return b(n,t)}function b(e,n){var t,r=n.children,o=j(r);if(0===o)e.length>1&&e.splitText(1),e.nodeValue="",n.dom=e,t=e.nextSibling;else{if(o>1){t=e;for(var a=0;a<r.length;a++)t=p(t,r[a]);e=r[0].dom}else{var l=i(n,f(r,o));t=p(e,l),e=l.dom}n.dom=e;for(var d=0;e!==t;)d++,e=e.nextSibling;n.domLength=d}return t}function x(e){return e=""+e,te?(oe.innerText=e,e=oe.innerHTML):e=re?e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;"):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e}function y(e){return e=""+e,e.replace(/-{2,}/g,"-")}function C(e,n){var t=typeof n;return n=""+n,"number"!==t&&(n=re?n.split("&").join("&amp;").split('"').join("&quot;"):n.replace(/&/g,"&amp;").replace(/"/g,"&quot;")),e+'="'+n+'"'}function k(e,n,t,r,o,d){n=l(e,n);var u,h,g,m=j(n);if(r&&(e.ns=r),0===m)u=s(),c(t,u,o,d);else if(m>1){h=0;for(var p=0,b=n.length;b>p;p++)g=a(n,p),v(g,t,r,o,!1),h+=g.domLength||1;u=n[0].dom,d&&I(t,o)}else g=i(e,f(n,m)),v(g,t,r,o,d),u=g.dom,h=g.domLength;e.dom=u,e.domLength=h}function L(e,n,t,r,i,o){var a,l;if(r)for(l in r){var f=!1,d=r[l];if("style"===l){var s=i&&i[l];s!==d&&(f=T(e,s,r,d))}else S(n,l)?e[l]!==d&&(e[l]=d,f=!0):i&&i[l]===d||("class"!==l||t?w(e,l,d):e.className=d,f=!0);f&&o&&(a||(a=[])).push(l)}if(i)for(l in i)r&&void 0!==r[l]||("class"!==l||t?S(n,l)||e.removeAttribute(l):e.className="",o&&(a||(a=[])).push(l));return a}function w(e,n,t){if(t===!1)e.removeAttribute(n);else{t===!0&&(t="");var r,i=n.indexOf(":");if(-1!==i){var o=n.substr(0,i);switch(o){case"xlink":r="http://www.w3.org/1999/xlink"}}r?e.setAttributeNS(r,n,t):e.setAttribute(n,t)}}function T(n,t,r,i){var o,a=!1;if(!e(i)&&(!de||!t||e(t))){var l="";if(i)for(o in i)l+=o+": "+i[o]+"; ";i=l,de||(r.style=i)}var f=n.style;if(e(i))f.cssText=i,a=!0;else{if(i)for(o in i){var d=i[o];if(!t||t[o]!==d){var s=d.indexOf("!important");if(-1!==s)f.setProperty(o,d.substr(0,s),"important");else{if(t){var u=t[o];u&&-1!==u.indexOf("!important")&&f.removeProperty(o)}f.setProperty(o,d,"")}a=!0}}if(t)for(o in t)i&&void 0!==i[o]||(f.removeProperty(o),a=!0)}return a}function N(e,n,t,r){var i;if(t){e.virtualNode=n;for(i in t)r&&r[i]||E(e,i)}if(r)for(i in r)t&&t[i]||M(e,i)}function S(e,n){switch(e){case"input":return"value"===n||"checked"===n;case"textarea":return"value"===n;case"select":return"value"===n||"selectedIndex"===n;case"option":return"selected"===n}}function E(e,n){if("$"!==n[0])if(le)e.addEventListener(n,O,!1);else{var t="on"+n;t in e?e[t]=O:e.attachEvent(t,O)}}function M(e,n){if("$"!==n[0])if(le)e.removeEventListener(n,O,!1);else{var t="on"+n;t in e?e[t]=null:e.detachEvent(t,O)}}function V(n,t,r,o,d){o=l(t,o);var s=j(o);if(s>1)for(var u=0,c=o.length;c>u;u++)v(a(o,u),n,r);else if(0!==s){var h=f(o,s);!d&&e(h)?P(n,h):(h=i(t,h),v(h,n,r,null,!1,!d))}}function j(t){return n(t)?t.length:t||e(t)?-1:0}function A(n,t,r){r>1?H(n,t,0,t.length):0!==r&&(e(t)?n.removeChild(n.firstChild):I(n,o(t,r,n)))}function H(e,n,t,r){for(;r>t;t++)I(e,n[t])}function I(e,n){z(n);for(var t,r=n.dom,i=n.domLength||1;i--;)t=i>0?r.nextSibling:null,e.removeChild(r),r=t}function P(e,n,t){if(n)ae?e.textContent=n:e.innerText=n;else{if(t)for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(s())}}function $(n,t,r,s,u,c,h){if(u=l(t,u,s),u!==s){var g=j(s);if(0===g)return void V(n,t,r,u,!1);var m,p,b=j(u);if(0===b)return void A(n,s,g);if(2>b){if(p=f(u,b),!c&&e(p)){if(b===g){if(m=f(s,g),p===m)return;if(e(m))return void(n.firstChild.nodeValue=p)}return G(s,g),void P(n,p,!0)}if(2>g)return m=o(s,g,n),p=i(t,p,m),void K(m,p,n,r,null,0,h,!c)}-1===b&&(t.children=u=[u]),2>g&&(m=o(s,g,n),1===g?s[0]=m:s=[m]);var x,y=s.length,C=u.length,k=y-1,L=u.length-1,w=0,T=0,N=!0;e:for(;N&&k>=w&&L>=T;){N=!1;var S,E,M,$;for(S=s[w],M=a(u,T,S);S.key===M.key;){if(K(S,M,n,r,s,w+1,h),w++,T++,w>k||T>L)break e;S=s[w],M=a(u,T,S),N=!0}for(E=s[k],$=a(u,L);E.key===$.key;){if(K(E,$,n,r,u,L+1,h),k--,L--,w>k||T>L)break e;E=s[k],$=a(u,L),N=!0}for(;S.key===$.key;){if(x=C>L+1?u[L+1]:h,K(S,$,n,r,null,0,x),d(n,$,x),w++,L--,w>k||T>L)break e;S=s[w],$=a(u,L),N=!0}for(;E.key===M.key;){if(x=y>w?s[w]:h,K(E,M,n,r,null,0,x),d(n,M,x),k--,T++,w>k||T>L)break e;E=s[k],M=a(u,T),N=!0}}if(w>k)for(x=C>L+1?a(u,L+1):h,O=T;L>=O;O++)v(a(u,O),n,r,x);else if(T>L)H(n,s,w,k+1);else{var O,B=s[k+1],D={};for(O=k;O>=w;O--)m=s[O],m.next=B,D[m.key]=m,B=m;for(x=C>L+1?a(u,L+1):h,O=L;O>=T;O--){p=u[O];var q=p.key;m=D[q],m?(D[q]=null,B=m.next,K(m,p,n,r,null,0,x),n.nextSibling!=(x&&x.dom)&&d(n,p,x)):v(p,n,r,x),x=p}for(O=w;k>=O;O++)m=s[O],null!==D[m.key]&&I(n,m)}}}function O(e){e=R(e,this);var t=e.currentTarget,r=t.virtualNode.events[e.type];if(n(r)){for(var i=0,o=r.length;o>i;i++)if(F(r[i],t,e),ce){ce=!1;break}}else F(r,t,e)}function B(){this.defaultPrevented=!0,this.returnValue=!1}function D(){this.cancelBubble=!0}function q(){ce=!0,this.stopPropagation()}function R(e,n){return e||(e=window.event,e.preventDefault||(e.preventDefault=B,e.stopPropagation=D,e.defaultPrevented=e.returnValue===!1,e.target=e.srcElement),e.currentTarget=n.nodeType?n:e.target),e.stopImmediatePropagation=q,e}function F(e,n,t){try{e.call(n,t)===!1&&t.preventDefault()}catch(r){ee.error(r.stack||r)}}function K(e,n,t,r,i,o,a,l){if(n!==e){var f=n.tag;if(e.tag!==f)v(n,t,r,e,!0);else{var d=e.dom,s=e.children,u=n.children;switch(f){case void 0:var c=i&&o<i.length?i[o]:a;W(e,s,n,u,t,r,c);break;case"#":case"!":s!==u&&(d.nodeValue=u),n.dom=d;break;case"<":s!==u?v(n,t,null,e,!0,l):(n.dom=e.dom,n.domLength=e.domLength);break;default:var g=n.attrs,m=e.attrs;if((g&&g.is)!==(m&&m.is))return void v(n,t,r,e,!0);var p=e.ns;p&&(n.ns=p),n.dom=d,u!==s&&$(d,n,p,s,u,!1);var b=n.events,x=e.events;if(g!==m){var y=b&&b.$changed,C=L(d,f,p,g,m,!!y);C&&h(y,"$changed",d,n,"changes",C)}b!==x&&N(d,n,b,x)}}}}function W(e,t,r,i,o,a,f){if(i=l(r,i,t),i!==t){var d,u,v=j(i),h=j(t);if(a&&(r.ns=a),0===v)0===h?d=e.dom:(A(o,t,h),d=s(),c(o,d,f));else{if(0===h)return o.removeChild(e.dom),void k(r,i,o,a,f);if($(o,r,a,t,i,!0,f),i=r.children,n(i)){d=i[0].dom,u=0;for(var g=0,m=i.length;m>g;g++)u+=i[g].domLength||1}else d=i.dom,u=i.domLength}r.dom=d,r.domLength=u}}function z(n){if(!e(n)){var t=n.dom;if(t){var r=n.events;if(r){for(var i in r)M(t,i);var o=r.$destroyed;o&&h(o,"$destroyed",t,n)}t.virtualNode&&(t.virtualNode=void 0)}var a=n.children;a&&G(a,j(a))}}function G(e,n){if(n>1)for(var t=0,r=e.length;r>t;t++)z(e[t]);else 0!==n&&z(f(e,n))}function J(e,n){var t;for(t in e)n[t]=e[t];for(t in n)void 0===e[t]&&(n[t]=void 0)}function Q(e){e&&e!=Y.body&&e!=Y.activeElement&&e.focus()}var U,X,Y=window.document,Z=window.navigator,_=function(){},ee=window.console||{warn:_,error:_},ne=Z.userAgent,te=-1!==ne.indexOf("WebKit"),re=-1!==ne.indexOf("Firefox"),ie=-1!==ne.indexOf("Trident"),oe=Y.createElement("div"),ae="textContent"in Y,le="addEventListener"in Y,fe="createRange"in Y,de="setProperty"in oe.style,se=Y.createElement("p");se.insertAdjacentHTML&&(se.appendChild(Y.createTextNode("a")),se.insertAdjacentHTML("beforeend","b"),U=1===se.childNodes.length,se=Y.createElement("p"),se.appendChild(s()),se.insertAdjacentHTML("beforeend","<b>"),X=3!==se.firstChild.nodeType);var ue="",ce=(fe?Y.createRange():null,!1),ve={create:function(e){return e=r(e),v(e),e},append:function(e,n){return n=r(n),v(n,e),n},update:function(e,n){var t=Y.activeElement;return n=r(n,e),K(e,n,e.dom.parentNode),J(n,e),Q(t),e},updateChildren:function(e,n){var t=Y.activeElement,r=e.children;r!==n&&$(e.dom,e,e.ns,r,n,!e.tag),Q(t)},remove:function(e){var n=e.dom.parentNode;I(n,e)}};return{vdom:ve}});